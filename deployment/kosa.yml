---
# this no-op task works around this really lame bug:
# https://github.com/ansible/ansible/issues/14655
- hosts: all
  remote_user: "{{ deploy_user }}" # for some reason, root hangs

- hosts: all
  remote_user: "{{ deploy_user }}"
  gather_facts: true
  environment:
    RAILS_ENV: development # TODO: set a real environment
    RBENV_ROOT: '{{ rbenv_root }}'
    PATH: '{{ rbenv_root }}/bin:{{ rbenv_root }}/shims:{{ rbenv_root }}/plugins/ruby-build/bin:{{ ansible_env.PATH }}'
  roles:
    - { role: deploy, tags: ['deploy'] }
    - { role: ansistrano.deploy, tags: ['ansistrano.deploy'] }
